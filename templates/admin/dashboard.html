{% extends 'base.html' %}

{% block title %}管理员仪表盘 - 课程进度管理系统{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-12">
        <h1 class="mb-4">管理员仪表盘</h1>
    </div>
</div>

<!-- 数据概览卡片 -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card bg-primary text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h5 class="card-title">总教师数</h5>
                        <p class="card-text display-4">{{ total_teachers }}</p>
                    </div>
                    <i class="fas fa-users fa-3x"></i>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-success text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h5 class="card-title">总订单数</h5>
                        <p class="card-text display-4">{{ total_orders }}</p>
                    </div>
                    <i class="fas fa-list-alt fa-3x"></i>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-warning text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h5 class="card-title">待审核工资申请</h5>
                        <p class="card-text display-4">{{ pending_applications }}</p>
                    </div>
                    <i class="fas fa-file-invoice-dollar fa-3x"></i>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-info text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h5 class="card-title">已结算工资总额</h5>
                        <p class="card-text display-4">¥{{ approved_amount }}</p>
                    </div>
                    <i class="fas fa-coins fa-3x"></i>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 操作按钮区域 -->
<div class="row mb-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">快速操作</h5>
                <div class="d-flex flex-wrap gap-2">
                    <a href="{% url 'orders:admin_order_create' %}" class="btn btn-primary">
                        <i class="fas fa-plus"></i> 创建订单
                    </a>
                    <a href="{% url 'accounts:admin_teacher_list' %}" class="btn btn-secondary">
                        <i class="fas fa-users"></i> 教师管理
                    </a>
                    <a href="{% url 'orders:admin_order_list' %}" class="btn btn-secondary">
                        <i class="fas fa-list"></i> 查看所有订单
                    </a>
                    <a href="{% url 'orders:admin_log_list' %}" class="btn btn-secondary">
                        <i class="fas fa-history"></i> 查看操作日志
                    </a>
                    <a href="{% url 'orders:data_backup' %}" class="btn btn-secondary">
                        <i class="fas fa-database"></i> 数据备份管理
                    </a>
                    <a href="{% url 'orders:salary_application_list' %}" class="btn btn-warning text-white">
                        <i class="fas fa-file-invoice-dollar"></i> 审核工资申请
                    </a>
                    {% if user.is_super_admin %}
                        <a href="{% url 'accounts:admin_list' %}" class="btn btn-info text-white">
                            <i class="fas fa-user-cog"></i> 管理管理员账号
                        </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 最新订单和申请列表 -->
<div class="row">
    <!-- 最新订单 -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="card-title">最新订单</h5>
                    <a href="{% url 'orders:admin_order_list' %}" class="btn btn-sm btn-secondary">查看全部</a>
                </div>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>订单编号</th>
                            <th>订单名称</th>
                            <th>分配教师</th>
                            <th>状态</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for order in latest_orders %}
                            <tr>
                                <td>{{ order.order_number }}</td>
                                <td>{{ order.name }}</td>
                                <td>{{ order.teacher.username }}</td>
                                <td>
                                    {% if order.status == 'pending' %}
                                        <span class="badge bg-warning">待开课</span>
                                    {% elif order.status == 'ongoing' %}
                                        <span class="badge bg-info">进行中</span>
                                    {% elif order.status == 'completed' %}
                                        <span class="badge bg-success">已完成</span>
                                    {% endif %}
                                </td>
                            </tr>
                        {% empty %}
                            <tr>
                                <td colspan="4" class="text-center">暂无订单</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <!-- 待审核工资申请 -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="card-title">待审核工资申请</h5>
                    <a href="{% url 'orders:salary_application_list' %}" class="btn btn-sm btn-secondary">查看全部</a>
                </div>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>申请编号</th>
                            <th>教师</th>
                            <th>申请金额</th>
                            <th>申请时间</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for application in pending_applications_list %}
                            <tr>
                                <td>{{ application.id }}</td>
                                <td>{{ application.teacher.username }}</td>
                                <td>¥{{ application.apply_amount }}</td>
                                <td>{{ application.created_at|date:'Y-m-d H:i' }}</td>
                            </tr>
                        {% empty %}
                            <tr>
                                <td colspan="4" class="text-center">暂无待审核申请</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<!-- 引入Font Awesome图标库 -->
{% endblock %}